<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sadara Iftar Check-in</title>

<style>
*{box-sizing:border-box}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  margin:0;
  background:#f6f6f6;
  padding:16px;
}

.wrap{max-width:720px;margin:28px auto}

.card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  box-shadow:0 10px 24px rgba(0,0,0,.08);
}

/* Header */
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
  min-width:0;
}

.brand img{
  height:44px;
  max-width:150px;
  object-fit:contain;
}

.titleBox{
  text-align:right;
  min-width:0;
}

.title{
  font-size:18px;
  font-weight:900;
  line-height:1.1;
  margin:0;
}

.subhead{
  margin-top:6px;
  color:#6b7280;
  font-size:13px;
}

.pill{
  display:inline-block;
  padding:8px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  background:#eef2ff;
  color:#1e40af;
  margin-top:6px;
  white-space:nowrap;
}

input{
  width:100%;
  font-size:20px;
  padding:14px;
  border-radius:14px;
  border:1px solid #d1d5db;
  outline:none;
}
input:focus{
  border-color:#1976d2;
  box-shadow:0 0 0 4px rgba(25,118,210,.12);
}

button{
  margin-top:12px;
  width:100%;
  padding:14px;
  font-size:18px;
  border:0;
  border-radius:14px;
  background:#1976d2;
  color:#fff;
  font-weight:800;
  cursor:pointer;
}

button:disabled{
  opacity:.65;
  cursor:not-allowed;
}

.status{
  margin-top:14px;
  padding:22px;
  border-radius:16px;
  font-size:26px;
  font-weight:900;
  text-align:center;
  display:none;
  color:#fff;
}

.green{background:#1faa59}
.red{background:#e53935}
.black{background:#111}

.details{
  margin-top:10px;
  padding:12px;
  border:1px solid #eee;
  border-radius:14px;
  display:none;
  background:#fafafa;
}

.details .name{font-weight:800;font-size:16px;margin-bottom:6px}
.meta{font-size:13px;color:#374151}

/* Mobile polish */
@media (max-width:420px){
  .brand img{height:40px; max-width:130px;}
  .title{font-size:17px;}
}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

  <!-- âœ… New Header -->
  <div class="top">
    <div class="brand">
      <img src="sadara-logo.png" alt="Sadara Logo">
    </div>

    <div class="titleBox">
      <div class="title">Sadara Iftar Check-in</div>
      <div class="pill" id="doorPill">Operator</div>
    </div>
  </div>

  <!-- âœ… UI shows Badge only (but phone still works if typed) -->
  <div class="subhead">Enter Badge Number</div>

  <!-- âœ… numeric keypad + digits-only -->
  <input
    id="inp"
    type="tel"
    inputmode="numeric"
    pattern="[0-9]*"
    placeholder="Enter Badge Number"
    autocomplete="off"
    autofocus
  >
  <button id="btn">Check</button>

  <div id="st" class="status"></div>

  <div id="details" class="details">
    <div class="name" id="personName"></div>
    <div class="meta">
      Badge: <span id="personBadge"></span><br>
      Phone: <span id="personPhone"></span>
    </div>
  </div>

</div>
</div>

<script>
// âœ… YOUR APPS SCRIPT URL
const API_URL = "https://script.google.com/macros/s/AKfycbxkCAne4jYdrin22pexmySd_1hbS5NGqugriSCZ4_O9sFmO872CEEnBxQTZCygxW0lf/exec";

// âœ… 10 operators using ?op=1..10
// Example links:
// /?op=1 , /?op=2 , ... /?op=10
const params = new URLSearchParams(window.location.search);
const opNum = parseInt(params.get("op") || "", 10);

// Backwards compatibility: if you still use ?door=Door-2 links
const doorParam = params.get("door");

const OPERATOR =
  (opNum >= 1 && opNum <= 10) ? `Operator #${opNum}` :
  (doorParam ? doorParam : "Operator #1");

document.getElementById("doorPill").textContent = "Operator: " + OPERATOR;

const inp = document.getElementById("inp");
const btn = document.getElementById("btn");
const st = document.getElementById("st");

const details = document.getElementById("details");
const personName = document.getElementById("personName");
const personBadge = document.getElementById("personBadge");
const personPhone = document.getElementById("personPhone");

let busy = false;

// âœ… Force digits-only even if user pastes text
inp.addEventListener("input", () => {
  inp.value = inp.value.replace(/\D/g, "");
});

function norm(v){
  return String(v||"").trim().replace(/\D/g,""); // digits only
}

function maskPhone(p){
  const s = String(p||"").replace(/\D/g,"");
  return s ? "****" + s.slice(-4) : "";
}

function show(type,msg,data){
  st.className="status "+type;
  st.style.display="block";
  st.textContent=msg;

  if(data && data.name){
    details.style.display="block";
    personName.textContent=data.name;
    personBadge.textContent=data.badge||"";
    personPhone.textContent=maskPhone(data.phone);
  }else{
    details.style.display="none";
  }
}

// JSONP helper
function jsonp(url){
  return new Promise((resolve,reject)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    const script=document.createElement("script");

    window[cb]=(data)=>{
      delete window[cb];
      script.remove();
      resolve(data);
    };

    script.onerror=()=>{
      delete window[cb];
      script.remove();
      reject();
    };

    script.src=url+(url.includes("?")?"&":"?")+"callback="+cb;
    document.body.appendChild(script);
  });
}

async function check(){
  if (busy) return; // prevent double-click

  const input=norm(inp.value);
  if(!input){ show("black","ENTER VALUE"); return; }

  // lock UI
  busy = true;
  btn.disabled = true;
  inp.disabled = true;
  const oldBtnText = btn.textContent;
  btn.textContent = "Checking...";

  try{
    const url=`${API_URL}?action=checkin&input=${encodeURIComponent(input)}&operator=${encodeURIComponent(OPERATOR)}`;
    const data=await jsonp(url);

    if(data.status==="GREEN") show("green","âœ… WELCOME",data);
    else if(data.status==="RED") show("red","âŒ DUPLICATED",data);
    else show("black","ðŸš« NOT IN LIST");

  }catch(e){
    show("black","NETWORK / API ERROR");
  } finally {
    // unlock UI
    busy = false;
    btn.disabled = false;
    inp.disabled = false;
    btn.textContent = oldBtnText;

    setTimeout(()=>{inp.value="";inp.focus();},700);
  }
}

btn.onclick=check;
inp.addEventListener("keydown",e=>{if(e.key==="Enter")check();});
</script>
</body>
</html>
